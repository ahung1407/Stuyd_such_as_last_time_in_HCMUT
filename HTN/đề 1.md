Chào bạn, dựa trên cấu trúc đề thi bạn cung cấp (30% Trắc nghiệm + 70% Tự luận tập trung vào thiết kế hệ thống) và nội dung các bài giảng CO3053 (Hệ thống nhúng), tôi xin thiết kế một đề thi mẫu để bạn ôn tập.

Đề thi này bao quát các kiến thức về đặc tả hệ thống, kiến trúc phần cứng, quy trình phát triển và kỹ thuật lập trình, với trọng tâm là vẽ máy trạng thái (State Machine) và lưu đồ giải thuật (Flowchart).

---

# ĐỀ THI CUỐI KỲ MẪU: HỆ THỐNG NHÚNG (CO3053)

**Thời gian:** 90 phút
**Hình thức:** Tự luận (Sinh viên làm bài trên giấy thi)
**Tài liệu:** Được sử dụng 02 tờ A4 tài liệu tham khảo

---

## PHẦN I: TRẮC NGHIỆM & CÂU HỎI NGẮN (30 Điểm)

_(Chọn đáp án đúng nhất hoặc trả lời ngắn gọn)_

**Câu 1:** Trong các chỉ số thiết kế (Design Metrics), chi phí NRE (Non-Recurring Engineering cost) là gì?
A. Chi phí sản xuất từng đơn vị sản phẩm.
B. Chi phí một lần cho việc thiết kế và nghiên cứu hệ thống.
C. Chi phí bảo trì phần mềm sau khi phát hành.
D. Tổng chi phí năng lượng tiêu thụ của hệ thống.
_(Gợi ý: Xem lại định nghĩa NRE cost và Unit cost,)_

**Câu 2:** Đặc điểm nào sau đây **KHÔNG** phải là đặc trưng phổ biến của hệ thống nhúng?
A. Được thiết kế cho một hoặc một vài chức năng chuyên biệt (Single-functioned).
B. Bị ràng buộc chặt chẽ về tài nguyên (Tightly-constrained).
C. Có khả năng thực thi đa dụng như một máy tính cá nhân (General purpose).
D. Phải phản ứng với môi trường trong thời gian thực (Reactive and real-time).
_(Gợi ý: Xem lại 3 đặc trưng cơ bản của hệ thống nhúng,)_

**Câu 3:** Trong kiến trúc Bus, cơ chế trọng tài (Arbitration) kiểu "Priority-based Preemptive" hoạt động như thế nào?
A. Thiết bị nào gửi yêu cầu trước sẽ được phục vụ trước (FIFO).
B. Các thiết bị tự thỏa thuận với nhau mà không cần bộ trọng tài trung tâm.
C. Thiết bị có độ ưu tiên cao có thể chiếm quyền sử dụng Bus ngay lập tức từ thiết bị có độ ưu tiên thấp hơn đang chạy.
D. Bộ trọng tài cấp quyền lần lượt theo vòng tròn (Daisy-chain).
_(Gợi ý: Xem lại slide về Bus Arbitration,)_

**Câu 4:** Khi lập trình C cho hệ thống nhúng, từ khóa `volatile` được sử dụng để làm gì?
A. Khai báo biến hằng số không thể thay đổi.
B. Báo cho trình biên dịch biết biến có thể bị thay đổi bất ngờ bởi phần cứng/ISR và không được tối ưu hóa.
C. Tăng tốc độ truy xuất biến bằng cách lưu vào thanh ghi CPU.
D. Định nghĩa một biến toàn cục được chia sẻ giữa các file.
_(Gợi ý: Xem lại vấn đề Shared-data và từ khóa volatile,)_

**Câu 5:** Mục tiêu chính của Hệ điều hành thời gian thực (RTOS) khác với hệ điều hành thông thường là gì?
A. Tối đa hóa thông lượng (Throughput) xử lý dữ liệu.
B. Đảm bảo tính đoán định (Determinism) về thời gian phản hồi.
C. Cung cấp giao diện đồ họa đẹp mắt cho người dùng.
D. Tối ưu hóa dung lượng bộ nhớ lưu trữ.
_(Gợi ý: Xem lại định nghĩa và mục tiêu của RTOS,)_

**Câu 6:** (Câu hỏi ngắn) Hãy liệt kê 3 giao tiếp Bus phổ biến dùng để mở rộng hoặc kết nối ngoại vi trong hệ thống nhúng.
_(Gợi ý: I2C, SPI, UART, PCI, USB,)_

---

## PHẦN II: TỰ LUẬN - THIẾT KẾ HỆ THỐNG (70 Điểm)

### Bài toán: Hệ Thống Cổng Kiểm Soát Vé Tự Động (Smart Ticket Gate)

Bạn hãy thiết kế khối điều khiển cho một hệ thống cổng soát vé tự động tại nhà ga tàu điện. Hệ thống được mô tả như sau:

- Hệ thống có 2 cảm biến vị trí: `S_Entry` (phát hiện người đứng trước cổng) và `S_Exit` (phát hiện người đã đi qua cổng).
- Hệ thống có đầu đọc thẻ RFID: `Card_Reader`.
- Cơ cấu chấp hành là một động cơ điều khiển cánh cổng (`Motor`), có thể điều khiển `OPEN` (mở cổng) hoặc `CLOSE` (đóng cổng).
- Hệ thống có đèn LED báo hiệu: `LED_Green` (cho phép đi) và `LED_Red` (cấm đi/lỗi).

**Hoạt động của hệ thống:**

1.  Ban đầu cổng đóng, `LED_Red` sáng (Trạng thái `LOCKED`).
2.  Khi có người (`S_Entry` active) VÀ quẹt thẻ hợp lệ (`Valid_Card`): Hệ thống mở cổng (`Motor` chạy mở), `LED_Green` sáng.
3.  Khi cổng đã mở hoàn toàn (giả sử có cảm biến hành trình hoặc timer xác nhận), hệ thống chuyển sang trạng thái chờ người đi qua (`WAIT_PASS`).
4.  Khi người dùng đi qua hẳn (`S_Exit` kích hoạt rồi tắt): Hệ thống đóng cổng lại (`Motor` chạy đóng).
5.  Nếu cổng đang mở mà không có người đi qua trong 10 giây (Time-out): Cổng tự động đóng lại và quay về `LOCKED`.
6.  Nếu thẻ không hợp lệ (`Invalid_Card`): `LED_Red` nhấp nháy 3 lần rồi quay lại trạng thái chờ ban đầu.

---

### Yêu cầu thực hiện:

**Câu 1 (15 điểm): Phân tích hệ thống**
a. Xác định các tín hiệu Đầu vào (Inputs) và Đầu ra (Outputs) của hệ thống.
b. Đề xuất kiến trúc phần cứng dạng khối (Block Diagram) cho hệ thống này. Bạn sẽ chọn vi xử lý loại nào (8-bit, 16-bit hay 32-bit) và giải thích ngắn gọn lý do (xét trên khía cạnh chi phí và hiệu năng).
_(Gợi ý: Xem lại cách phân tích Input/Output và lựa chọn CPU,)_

**Câu 2 (30 điểm): Thiết kế Máy trạng thái (State Machine Diagram)**
Vẽ biểu đồ máy trạng thái (State Machine Diagram) mô tả hành vi của hệ thống trên.

- Yêu cầu xác định rõ các trạng thái (States). Ví dụ: `LOCKED`, `OPENING`, `WAIT_PASS`, `CLOSING`, `ERROR`.
- Ghi rõ điều kiện chuyển đổi (Transitions) giữa các trạng thái (sự kiện nút bấm, cảm biến, timer...).
- Xác định rõ đầu ra (Outputs) tại từng trạng thái (theo mô hình Moore) hoặc trên cung chuyển đổi (theo mô hình Mealy).
  _(Gợi ý: Tham khảo các ví dụ Garage Door hoặc Traffic Light trong bài giảng,,)_

**Câu 3 (20 điểm): Thiết kế Lưu đồ giải thuật (Flowchart)**
Vẽ lưu đồ giải thuật (Flowchart) cho chương trình con xử lý sự kiện **"Quẹt thẻ"** (Card Processing).

- Lưu đồ bắt đầu khi phát hiện có thẻ được đưa vào.
- Thực hiện đọc dữ liệu thẻ.
- Kiểm tra tính hợp lệ (Decision block).
- Nếu hợp lệ: Kích hoạt mở cổng, bật đèn xanh, khởi động Timer 10s.
- Nếu không hợp lệ: Bật hàm nháy đèn đỏ, giữ nguyên trạng thái đóng.
  _(Gợi ý: Sử dụng đúng các ký hiệu hình thoi (decision), hình chữ nhật (process) như bài giảng,)_

**Câu 4 (5 điểm): Lựa chọn mô hình lập trình**
Để hiện thực hệ thống trên, bạn sẽ chọn mô hình lập trình nào trong số các mô hình sau: **Round-robin**, **Round-robin with Interrupts**, hay **RTOS**? Giải thích lý do lựa chọn của bạn dựa trên yêu cầu về độ phản hồi (Responsiveness) và độ phức tạp của hệ thống.
_(Gợi ý: Hệ thống này có yêu cầu phản hồi thẻ nhanh (ngắt) và xử lý motor/timeout đồng thời. Xem lại ưu nhược điểm các mô hình,,)_

---

### Gợi ý đáp án và nguồn tham khảo cho bạn:

- **Câu 1:** Input gồm các Sensor, Card Reader. Output gồm Motor, LEDs. Vi xử lý có thể chọn dòng 32-bit (như ARM Cortex M) giá rẻ vì cần xử lý giao tiếp RFID và Timer, hoặc 8-bit nếu tối ưu chi phí cực đại nhưng sẽ khó mở rộng,.
- **Câu 2:** Bạn cần vẽ các vòng tròn trạng thái. Lưu ý trạng thái trung gian như `OPENING` và `CLOSING` là cần thiết vì motor không chạy tức thời (giống bài toán cửa cuốn Garage Door,). Cần có trạng thái `ERROR` hoặc logic xử lý thẻ lỗi.
- **Câu 3:** Sử dụng hình thoi để kiểm tra `Is_Card_Valid?`. Nhớ reset Timer nếu logic yêu cầu,.
- **Câu 4:** Mô hình **Round-robin with Interrupts** hoặc **Event-driven** là phù hợp nhất. RTOS có thể hơi "thừa" (overkill) cho một hệ thống đơn giản thế này, nhưng Round-robin thuần túy thì có thể bị trễ khi đọc thẻ RFID,.

Chúc bạn ôn tập tốt!
